# Apache Default Virtual Host Template
# Copy to /etc/apache2/sites-available/yoursite.conf
# Enable with: a2ensite yoursite
#
# Custom error pages are automatically available in /var/www/errors/
# You can customize the error pages by editing files in /var/www/errors/

<VirtualHost *:80>
    ServerName example.com
    ServerAlias www.example.com
    ServerAdmin webmaster@example.com

    DocumentRoot /var/www/example.com/public

    # Custom error pages
    ErrorDocument 403 /errors/403.html
    ErrorDocument 404 /errors/404.html
    ErrorDocument 500 /errors/500.html
    ErrorDocument 502 /errors/502.html
    ErrorDocument 503 /errors/503.html

    <Directory /var/www/example.com/public>
        Options -Indexes +FollowSymLinks +MultiViews
        AllowOverride All
        Require all granted

        # Enable .htaccess
        <IfModule mod_rewrite.c>
            RewriteEngine On
        </IfModule>
    </Directory>

    # Allow access to error pages directory
    <Directory /var/www/errors>
        Require all granted
    </Directory>

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/example.com-error.log
    CustomLog ${APACHE_LOG_DIR}/example.com-access.log combined

    # Security Headers
    <IfModule mod_headers.c>
        Header always set X-Frame-Options "SAMEORIGIN"
        Header always set X-Content-Type-Options "nosniff"
        Header always set X-XSS-Protection "1; mode=block"
        Header always set Referrer-Policy "no-referrer-when-downgrade"
    </IfModule>

    # Deny access to hidden files
    <FilesMatch "^\.">
        Require all denied
    </FilesMatch>

    # Deny access to backup files
    <FilesMatch "~$">
        Require all denied
    </FilesMatch>

    # Deny access to configuration files
    <FilesMatch "\.(yml|yaml|ini|conf|log)$">
        Require all denied
    </FilesMatch>

    # Static file caching
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresByType image/jpg "access plus 1 month"
        ExpiresByType image/jpeg "access plus 1 month"
        ExpiresByType image/gif "access plus 1 month"
        ExpiresByType image/png "access plus 1 month"
        ExpiresByType image/svg+xml "access plus 1 month"
        ExpiresByType text/css "access plus 1 week"
        ExpiresByType application/javascript "access plus 1 week"
        ExpiresByType application/x-javascript "access plus 1 week"
        ExpiresByType text/javascript "access plus 1 week"
        ExpiresByType font/ttf "access plus 1 year"
        ExpiresByType font/woff "access plus 1 year"
        ExpiresByType font/woff2 "access plus 1 year"
    </IfModule>

    # Disable ETags
    <IfModule mod_headers.c>
        Header unset ETag
    </IfModule>
    FileETag None

</VirtualHost>

# SSL Configuration (uncomment after obtaining SSL certificate)
# <VirtualHost *:443>
#     ServerName example.com
#     ServerAlias www.example.com
#     ServerAdmin webmaster@example.com
#
#     DocumentRoot /var/www/example.com/public
#
#     # SSL Engine
#     SSLEngine on
#     SSLCertificateFile /etc/letsencrypt/live/example.com/fullchain.pem
#     SSLCertificateKeyFile /etc/letsencrypt/live/example.com/privkey.pem
#
#     # SSL Protocol and Cipher Configuration
#     SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
#     SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384
#     SSLHonorCipherOrder off
#     SSLSessionTickets off
#
#     # HSTS (optional, but recommended)
#     Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
#
#     # Custom error pages
#     ErrorDocument 403 /errors/403.html
#     ErrorDocument 404 /errors/404.html
#     ErrorDocument 500 /errors/500.html
#     ErrorDocument 502 /errors/502.html
#     ErrorDocument 503 /errors/503.html
#
#     # Include all Directory and other configurations from above
#     # ... (copy from above)
# </VirtualHost>

# HTTP to HTTPS redirect (uncomment after obtaining SSL certificate)
# <VirtualHost *:80>
#     ServerName example.com
#     ServerAlias www.example.com
#
#     RewriteEngine On
#     RewriteCond %{HTTPS} off
#     RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
# </VirtualHost>
